name: superagent
services:
  superagent-ui:
    container_name: superagent-ui
    networks:
      - superagent_network
    build:
      context: ../ui
      dockerfile: Dockerfile
      args:
        NEXT_PUBLIC_SUPABASE_URL: ${NEXT_PUBLIC_SUPABASE_URL}
        NEXT_PUBLIC_SUPABASE_ANON_KEY: ${NEXT_PUBLIC_SUPABASE_ANON_KEY}
        NEXT_PUBLIC_SUPERAGENT_API_URL: ${NEXT_PUBLIC_SUPERAGENT_API_URL}
        NEXT_PUBLIC_SUPABASE_STORAGE_NAME: ${NEXT_PUBLIC_SUPABASE_STORAGE_NAME}
        NEXT_PUBLIC_SEGMENT_WRITE_KEY: ${NEXT_PUBLIC_SEGMENT_WRITE_KEY}
        NEXT_PUBLIC_APIDECK_API_KEY: ${NEXT_PUBLIC_APIDECK_API_KEY}
        NEXT_PUBLIC_APIDECK_API_ID: ${NEXT_PUBLIC_APIDECK_API_ID}
        NEXT_PUBLIC_STRIPE_SECRET_KEY: ${NEXT_PUBLIC_STRIPE_SECRET_KEY}
        NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY: ${NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY}
        NEXT_PUBLIC_LANGFUSE_PUBLIC_KEY: ${NEXT_PUBLIC_LANGFUSE_PUBLIC_KEY}
        NEXT_PUBLIC_LANGFUSE_BASE_URL: ${NEXT_PUBLIC_LANGFUSE_BASE_URL}
    command: /bin/sh -c "npm run supabase:docker:push --debug && npm start"
    environment:
      - PORT=3000
      - SUPABASE_DB_URL=${SUPABASE_DB_URL}
      - SUPABASE_URL=${NEXT_PUBLIC_SUPABASE_URL}
      - SUPABASE_KEY=${NEXT_PUBLIC_SUPABASE_ANON_KEY}
      - SUPABASE_SERVICEROLE_KEY=${SUPABASE_SERVICEROLE_KEY}
      - SUPABASE_ACCESS_TOKEN=${SUPABASE_ACCESS_TOKEN}
      - GITHUB_CLIENT_ID=${GITHUB_CLIENT_ID}
      - GITHUB_CLIENT_SECRET=${GITHUB_CLIENT_SECRET}
      - LOOPS_API_KEY=${LOOPS_API_KEY}
      - NEXT_PUBLIC_SEGMENT_WRITE_KEY=${NEXT_PUBLIC_SEGMENT_WRITE_KEY}
      - NEXT_PUBLIC_SUPABASE_URL=${NEXT_PUBLIC_SUPABASE_URL}
      - NEXT_PUBLIC_SUPABASE_ANON_KEY=${NEXT_PUBLIC_SUPABASE_ANON_KEY}
      - NEXT_PUBLIC_SUPERAGENT_API_URL=${NEXT_PUBLIC_SUPERAGENT_API_URL}
      - NEXT_PUBLIC_SUPABASE_STORAGE_NAME=${NEXT_PUBLIC_SUPABASE_STORAGE_NAME}
      - NEXT_PUBLIC_APIDECK_API_KEY=${NEXT_PUBLIC_APIDECK_API_KEY}
      - NEXT_PUBLIC_APIDECK_API_ID=${NEXT_PUBLIC_APIDECK_API_ID}
      - NEXT_PUBLIC_STRIPE_SECRET_KEY=${NEXT_PUBLIC_STRIPE_SECRET_KEY}
      - NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=${NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY}
      - NEXT_PUBLIC_LANGFUSE_PUBLIC_KEY=${NEXT_PUBLIC_LANGFUSE_PUBLIC_KEY}
      - NEXT_PUBLIC_LANGFUSE_BASE_URL=${NEXT_PUBLIC_LANGFUSE_BASE_URL}
      - NEXT_PUBLIC_POSTHOG_HOST=${NEXT_PUBLIC_POSTHOG_HOST}
      - NEXT_PUBLIC_POSTHOG_KEY=${NEXT_PUBLIC_POSTHOG_KEY}
      - NEXT_PUBLIC_STRIPE_DARK_PRICING_TABLE_ID=${NEXT_PUBLIC_STRIPE_DARK_PRICING_TABLE_ID}
      - NEXT_PUBLIC_STRIPE_LIGHT_PRICING_TABLE_ID=${NEXT_PUBLIC_STRIPE_LIGHT_PRICING_TABLE_ID}
      - NEXT_PUBLIC_STRIPE_PRO_PLAN=${NEXT_PUBLIC_STRIPE_PRO_PLAN}
      - NEXT_PUBLIC_STRIPE_HOBBY_PLAN=${NEXT_PUBLIC_STRIPE_HOBBY_PLAN}
    ports:
      - 3000:3000

networks:
  superagent_network:
    external: true
